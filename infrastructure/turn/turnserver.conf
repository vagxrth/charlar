# ─── Listening ────────────────────────────────────────────────────────────────
listening-port=3478
tls-listening-port=5349
listening-ip=${TURN_LISTENING_IP}

# ─── External IP (required behind NAT) ───────────────────────────────────────
# Maps the public IP to the private/listening IP so relay candidates carry the
# correct address. On a host with a directly assigned public IP, set both to
# the same value.
external-ip=${TURN_EXTERNAL_IP}/${TURN_LISTENING_IP}

# ─── Relay port range ────────────────────────────────────────────────────────
# 16 384 ports → ~8k concurrent media sessions
min-port=${TURN_MIN_PORT}
max-port=${TURN_MAX_PORT}

# ─── Authentication ──────────────────────────────────────────────────────────
# TURN REST API (RFC draft) — the shared secret MUST match the backend's
# TURN_SECRET so that HMAC-SHA1 ephemeral credentials validate.
use-auth-secret
static-auth-secret=${TURN_SECRET}

# ─── Realm ───────────────────────────────────────────────────────────────────
realm=${TURN_REALM}

# ─── TLS (TURNS on port 5349) ───────────────────────────────────────────────
cert=${TURN_TLS_CERT}
pkey=${TURN_TLS_KEY}

# ─── Security hardening ─────────────────────────────────────────────────────
fingerprint
stale-nonce=600
no-multicast-peers
no-loopback-peers
no-cli

# Block relay to RFC 1918 / RFC 6598 private ranges — prevents using TURN as a
# network pivot into internal infrastructure.
denied-peer-ip=10.0.0.0-10.255.255.255
denied-peer-ip=172.16.0.0-172.31.255.255
denied-peer-ip=192.168.0.0-192.168.255.255
denied-peer-ip=100.64.0.0-100.127.255.255

# ─── Logging (container-friendly) ───────────────────────────────────────────
log-file=stdout
verbose

# ─── Bandwidth ───────────────────────────────────────────────────────────────
# total-quota: aggregate bandwidth in MB/s — size to server NIC capacity
total-quota=100
# Per-session limits disabled; control at infrastructure level instead
bps-capacity=0
max-bps=0
